---
import "@/styles/pagefind.css";
import { type CollectionEntry, getCollection } from "astro:content";

const businessCategories: CollectionEntry<"business-category">[] =
    await getCollection("business-category");

const businesses: CollectionEntry<"businesses">[] =
    await getCollection("businesses");

const tags = businesses
    .map((b) => b.data.tags)
    .flat()
    .filter((t) => t !== undefined);

let firstResult = "a";

const randomIndex = Math.floor(Math.random() * tags.length) ?? 0;

if (tags !== undefined) {
    firstResult = tags[randomIndex];
}
---

<!-- <link href="/pagefind/pagefind-ui.css" rel="stylesheet" /> -->
<script src="/pagefind/pagefind-ui.js" is:inline></script>

<div id="search" class="mx-7" data-first-search={firstResult}></div>

<a
    href="/businesses"
    class="hover:scale-110 transition-all border border-black rounded-full py-1 px-2"
>
    Visit the directory
</a>

<script type="module">
    window.addEventListener("DOMContentLoaded", async (event) => {
        let pagefindUI = new PagefindUI({
            element: "#search",
            showEmptyFilters: true,
            openFilters: ["Type"],
            showImages: true,
            excerptLength: 10,
        });

        // get first result
        let firstSearch = document
            .querySelector("#search")
            .dataset.firstSearch.replace("-", " ");

        await pagefindUI.triggerSearch(firstSearch);

        let input = document.querySelector(".pagefind-ui__search-input");
        let clearButton = document.querySelector(".pagefind-ui__search-clear");

        let form = document.querySelector(".pagefind-ui__form");

        let searchWrapper = document.createElement("div");
        searchWrapper.classList.add("pagefind-ui__search-wrapper");

        form.appendChildBefore(input, searchWrapper);
    });
</script>
