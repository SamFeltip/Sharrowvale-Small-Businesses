---
import ContentPromotions from "@/components/content/ContentPromotions.astro";
import P from "@/components/elements/P.astro";
import SearchBox from "@/components/search/SearchBox.vue";
import SearchResults from "@/components/search/SearchResults.vue";
import SearchWrapper from "@/components/search/SearchWrapper.vue";
import ContentLayout from "@/layouts/ContentLayout.astro";
import { getCollection, getEntries, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
    const category: CollectionEntry<"category">[] =
        await getCollection("category");
    return category.map((business) => ({
        params: { slug: business.slug },
        props: business,
    }));
}

type Props = CollectionEntry<"category">;

const entry: Props = Astro.props;
const { name, description, bannerImage, promotedBusinesses } = entry.data;

const businesses = await getEntries(promotedBusinesses);
---

<ContentLayout image={bannerImage} description={description} title={name}>
    <P position="center" classList="p-12">
        {description}
    </P>

    {businesses.length >= 4 && <ContentPromotions businesses={businesses} />}

    <SearchWrapper client:only="vue" requiredCategory={name} />
</ContentLayout>
