---
import H2 from "@/components/elements/headers/H2.astro";
import CarouselWrapper from "./CarouselWrapper.vue";
import { getCollection } from "astro:content";

import Section from "@/components/elements/section.astro";
import { getPlaceCardsFromItems } from "@/scripts/placeCard/handler";
import { sortByIndex } from "@/scripts/placeCard/sorting";
import type { PlaceCardRef } from "@/components/placeCards/PlaceCardRef";

const tags = await getCollection("tags");

const promotedCategories = [
    "food-and-drink",
    "art-and-design",
    "cafe",
    "lunch",
    "pubs-and-bars",
    "restaurant",
    "healthcare",
];

const selectedCategories = tags.filter((tag) =>
    promotedCategories.includes(tag.slug)
);

// const categoryPlaceCardRefs: PlaceCardRef[] = getPlaceCardRefsFromItem("tags");

const categoryPlaceCardRefs: PlaceCardRef[] = selectedCategories.map((tag) => {
    if (tag.data.heroImage == null) {
        throw new Error(
            "tags must include a hero images to be matched to a PlaceCardRef"
        );
    }

    return {
        type: "tags",
        item: {
            name: tag.data.name,
            description: tag.data.description,
            heroImageMetaData: tag.data.heroImage,
            slug: tag.slug,
        },
    };
});

const categoryPlaceCards = await getPlaceCardsFromItems(categoryPlaceCardRefs);

const sortedCategoryPlaceCards = sortByIndex(
    categoryPlaceCards,
    promotedCategories
);
---

<Section direction="column">
    <H2 color="coral" position="center"> Independent Businesses </H2>

    <CarouselWrapper client:load items={sortedCategoryPlaceCards} />
</Section>
